(function(t,s){typeof exports=="object"&&typeof module!="undefined"?module.exports=s(require("vue")):typeof define=="function"&&define.amd?define(["vue"],s):(t=typeof globalThis!="undefined"?globalThis:t||self,t["draggable-panel"]=s(t.Vue))})(this,function(t){"use strict";var pe=Object.defineProperty,ve=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var V=(t,s,h)=>s in t?pe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):t[s]=h,A=(t,s)=>{for(var h in s||(s={}))xe.call(s,h)&&V(t,h,s[h]);if(U)for(var h of U(s))ye.call(s,h)&&V(t,h,s[h]);return t},B=(t,s)=>ve(t,me(s));var s=(()=>`.draggable-panel{position:relative;width:100%;height:100%;overflow:hidden;background:#EEEEEE;outline:none;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.draggable-panel *{outline:none}.draggable-panel.lock .chart-item:hover{filter:none}.draggable-panel.lock .chart-item .resizable{display:none!important}.draggable-panel .canvas{position:relative;background:#FFFFFF;box-shadow:0 5px 130px #00000026}.draggable-panel .canvas.moving{cursor:move}.draggable-panel .canvas:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(25,118,210,.3);visibility:hidden;opacity:0;transition:all .3s;z-index:10000}.draggable-panel .canvas.out-canvas-dragover:after{visibility:visible;opacity:1}.draggable-panel .chart-item{position:absolute;background:rgba(25,118,210,.3);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.draggable-panel .chart-item .content{position:relative;width:100%;height:100%;overflow:hidden;z-index:10}.draggable-panel .chart-item:hover{filter:brightness(1.05)}.draggable-panel .chart-item:hover .resizable{display:block}.draggable-panel .chart-item.moving .resizable-point{display:none!important}.draggable-panel .chart-item.resizing .resizable{display:block}.draggable-panel .chart-item .resizable{display:none}.draggable-panel .chart-item .resizable .resizable-point{position:absolute;width:16px;height:16px;display:flex;flex-direction:row;justify-content:center;align-items:center;z-index:20}.draggable-panel .chart-item .resizable .resizable-point:after{content:"";display:block;width:8px;height:8px;border:2px solid #1976D2;background:#FFFFFF}.draggable-panel .chart-item .resizable .resizable-line{position:absolute;box-sizing:border-box;z-index:10}.draggable-panel .chart-item .resizable .resizable-line:after{content:"";display:block;width:100%;height:100%;background:#1976D2}.draggable-panel .chart-item .resizable .a{top:0;left:0;transform:translate(-50%,-50%);cursor:nwse-resize}.draggable-panel .chart-item .resizable .b{top:0;right:0;transform:translate(50%,-50%);cursor:nesw-resize}.draggable-panel .chart-item .resizable .c{bottom:0;right:0;transform:translate(50%,50%);cursor:nwse-resize}.draggable-panel .chart-item .resizable .d{bottom:0;left:0;transform:translate(-50%,50%);cursor:nesw-resize}.draggable-panel .chart-item .resizable .e,.draggable-panel .chart-item .resizable .f,.draggable-panel .chart-item .resizable .g,.draggable-panel .chart-item .resizable .h{pointer-events:none}.draggable-panel .chart-item .resizable .e{top:0;left:50%;margin-left:-8px;transform:translateY(-50%)}.draggable-panel .chart-item .resizable .f{top:50%;right:0;margin-top:-8px;transform:translate(50%)}.draggable-panel .chart-item .resizable .g{bottom:0;left:50%;margin-left:-8px;transform:translateY(50%)}.draggable-panel .chart-item .resizable .h{left:0;top:50%;margin-top:-8px;transform:translate(-50%)}.draggable-panel .chart-item .resizable .i{top:0;left:0;width:100%!important;height:8px;padding-top:3px;padding-bottom:3px;padding-left:0!important;padding-right:0!important;transform:translateY(-50%);cursor:ns-resize}.draggable-panel .chart-item .resizable .j{right:0;top:0;height:100%!important;width:8px;padding-top:0!important;padding-bottom:0!important;padding-left:3px;padding-right:3px;transform:translate(50%);cursor:ew-resize}.draggable-panel .chart-item .resizable .k{bottom:0;left:0;width:100%!important;height:8px;padding-top:3px;padding-bottom:3px;padding-left:0!important;padding-right:0!important;transform:translateY(50%);cursor:ns-resize}.draggable-panel .chart-item .resizable .l{left:0;top:0;height:100%!important;width:8px;padding-top:0!important;padding-bottom:0!important;padding-left:3px;padding-right:3px;transform:translate(-50%);cursor:ew-resize}
`)(),h=t.markRaw(t.defineComponent({name:"draggable-panel",props:{width:{required:!0,type:Number},height:{required:!0,type:Number},data:{required:!0,type:Array},chartMinWidth:{required:!1,type:Number,default:100},chartMinHeight:{required:!1,type:Number,default:100},padding:{required:!1,type:Number,default:32},lock:{required:!1,type:Boolean,default:!1},canvasStyle:{required:!1,type:Object,default:{}},chartStyle:{required:!1,type:Object,default:{}},scaleMin:{required:!1,type:Number,default:.5},scaleMax:{required:!1,type:Number,default:10}},emits:["canvas-scale","canvas-drop"],setup(i,z){const w=t.ref(null),T=t.ref(null),C=t.ref(!1),E=t.ref(!1),S=t.ref(!1),W=t.ref(1),d=t.ref(1),F=t.ref(0),L=t.ref(0),m=t.ref(0),x=t.ref(0),I=t.ref(""),p=t.ref(null),g=t.ref(null),P=t.ref({x:0,y:0}),G=t.ref({x:0,y:0}),X=t.ref({x:0,y:0}),q=t.ref({x:0,y:0}),J=t.computed(()=>B(A({},i.canvasStyle),{width:i.width+"px",height:i.height+"px",transform:[`translate3d(${m.value}px, ${x.value}px, 0)`,`scale(${d.value})`].join(" ")})),Q=t.computed(()=>(e,a)=>{const{width:o,height:r,x:l,y:n}=e;return B(A({},i.chartStyle),{width:o+"px",height:r+"px",transform:`translateX(${l}px) translateY(${n}px)`,"z-index":100+a})});t.watch(d,e=>z.emit("canvas-scale",e));const Z=e=>{const{ctrlKey:a,metaKey:o}=e;if(!a&&!o||(e.preventDefault(),i.lock))return;let r=1/(1+e.deltaY*.001),l=d.value*r;l>i.scaleMax&&(r=i.scaleMax/d.value,l=i.scaleMax),l<i.scaleMin&&(r=i.scaleMin/d.value,l=i.scaleMin),d.value=l;const n={x:(r-1)*i.width*.5,y:(r-1)*i.height*.5};m.value-=(r-1)*(e.clientX-m.value)-n.x,x.value-=(r-1)*(e.clientY-x.value)-n.y},_=e=>{if(e.preventDefault(),i.lock)return;let a=d.value+.1;a>i.scaleMax&&(a=i.scaleMax),d.value=a},ee=e=>{if(e.preventDefault(),i.lock)return;let a=d.value-.1;a<i.scaleMin&&(a=i.scaleMin),d.value=a},ae=()=>{i.lock||(d.value=W.value,m.value=F.value,x.value=L.value)},te=()=>{if(i.lock)return;const{offsetWidth:e,offsetHeight:a}=w.value;d.value=1,m.value=(e-i.width)/2,x.value=(a-i.height)/2},ie=e=>{!C.value||i.lock||(E.value=!0,T.value.setPointerCapture(e.pointerId),G.value={x:e.clientX,y:e.clientY},X.value={x:e.clientX,y:e.clientY})},ne=e=>{if(!E.value)return;e.preventDefault();const a={x:e.clientX,y:e.clientY};P.value={x:a.x-X.value.x,y:a.y-X.value.y},X.value={x:a.x,y:a.y},m.value+=P.value.x,x.value+=P.value.y},re=()=>{E.value=!1},le=()=>{E.value=!1},oe=e=>{q.value={x:e.clientX,y:e.clientY}},se=(e,a)=>{!e.dataTransfer||(R(e.dataTransfer),p.value=a)},O=(e,a,o)=>{e.stopPropagation(),e.dataTransfer&&(R(e.dataTransfer),g.value=a,I.value=o)},ce=e=>{e.preventDefault();const{clientX:a,clientY:o}=e,r=(a-q.value.x)/d.value,l=(o-q.value.y)/d.value;if(q.value={x:a,y:o},p.value){const{width:n,height:u,x:v,y}=p.value,k=i.width-n,D=i.height-u;let f=v+r,c=y+l;f<0&&(f=0),c<0&&(c=0),f>k&&(f=k),c>D&&(c=D),p.value.x=f,p.value.y=c}if(g.value){const{width:n,height:u,x:v,y}=g.value,k=i.width-v,D=i.height-y,f=I.value;let c=n,b=u,M=v,Y=y;const j=()=>{c+=r,c<i.chartMinWidth&&(c=n),c>k&&(c=k)},$=()=>{b+=l,b<i.chartMinHeight&&(b=u),b>D&&(b=D)},N=()=>{M=v+r,c=n-r,M<0&&(M=0,c=n+v),c<i.chartMinWidth&&(c=n,M=v)},K=()=>{Y=y+l,b=u-l,Y<0&&(Y=0,b=u+y),b<i.chartMinHeight&&(b=u,Y=y)};f==="a"&&(N(),K()),f==="b"&&(j(),K()),f==="c"&&(j(),$()),f==="d"&&(N(),$()),f==="i"&&K(),f==="j"&&j(),f==="k"&&$(),f==="l"&&N(),g.value.width=c,g.value.height=b,g.value.x=M,g.value.y=Y}},de=e=>{p.value||g.value||(S.value=!1,z.emit("canvas-drop",e,{x:e.offsetX,y:e.offsetY}))},ue=()=>{w.value.focus(),p.value=null,g.value=null,document.querySelectorAll('.draggable-panel canvas[data-action="empty"]').forEach(e=>e.remove())},fe=()=>{p.value||g.value||(S.value=!0)},he=()=>{S.value=!1};function R(e){const a=document.createElement("canvas");a.setAttribute("data-action","empty"),w.value.appendChild(a),e.setDragImage(a,0,0),e.dropEffect="move",e.effectAllowed="move"}function H(){const{offsetWidth:e,offsetHeight:a}=w.value,o=e-i.padding,r=a-i.padding,l=e/a,n=i.width/i.height;W.value=l<n?o/i.width:r/i.height,F.value=(e-i.width)/2,L.value=(a-i.height)/2,d.value=W.value,m.value=F.value,x.value=L.value}function ge(e){const a=["a","b","c","d"],o=["e","f","g","h"],r=["i","j","k","l"],l=[];return a.forEach(n=>{l.push(t.h("div",{class:["resizable-point",n],key:n,tabindex:-1,draggable:!0,onDragstart:u=>O(u,e,n)}))}),o.forEach(n=>{l.push(t.h("div",{class:["resizable-point",n],key:n}))}),r.forEach(n=>{l.push(t.h("div",{class:["resizable-line",n],key:n,tabindex:-1,draggable:!0,onDragstart:u=>O(u,e,n)}))}),l}function be(){const e=[];return i.data.forEach((a,o)=>{var n,u;const r=z.slots.chart({chart:a,index:o}),l=z.slots[`chart-${a.id}`]?z.slots[`chart-${a.id}`]({chart:a,index:o}):null;e.push(t.h("div",{class:["chart-item",((n=p.value)==null?void 0:n.id)===a.id?"moving":"",((u=g.value)==null?void 0:u.id)===a.id?"resizing":""],key:a.id,style:Q.value(a,o),["data-id"]:a.id,tabindex:-1,draggable:!i.lock,onMousedown:oe,onDragstart:v=>se(v,a),onDragend:ue},[t.h("div",{class:["content"]},[r,l]),t.h("div",{class:["resizable"]},ge(a))]))}),e}return t.onMounted(()=>{H(),window.addEventListener("resize",H)}),t.onBeforeUnmount(()=>{window.removeEventListener("resize",H)}),()=>[t.h("div",{class:["draggable-panel",i.lock?"lock":""],tabindex:-1,ref:w,autofocus:!0,onkeydown(e){console.log(e);const{ctrlKey:a,metaKey:o}=e,r=e.code.toLowerCase();if(r==="space")return C.value=!0;if(r==="equal"&&(a||o))return _(e);if(r==="minus"&&(a||o))return ee(e);if(r==="digit0")return e.preventDefault(),ae();if(r==="enter")return e.preventDefault(),te()},onkeyup(e){e.code.toLowerCase()==="space"&&(C.value=!1)},onwheel:Z,onDragover:ce},t.h("div",{ref:T,class:["canvas",S.value?"out-canvas-dragover":"",C.value?"moving":""],style:J.value,onPointerdown:ie,onPointermove:ne,onPointerup:re,onPointercancel:le,onDragenter:fe,onDragleave:he,onDrop:de},be()))]}}));return h});
//# sourceMappingURL=draggable-panel.umd.js.map
